{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/nicos/Dev/poc/poc-pwa/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { ChangeDetectorRef } from '@angular/core';\nimport { liveQuery } from 'dexie';\nimport { from, map, mergeMap, toArray } from 'rxjs';\nimport { db } from 'src/services/db';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/services/crud-api.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/forms\";\nimport * as i4 from \"./item-list/item-list.component\";\n\nfunction HomeComponent_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"div\");\n    i0.ÉµÉµelement(1, \"item-list\", 6);\n    i0.ÉµÉµelementEnd();\n  }\n\n  if (rf & 2) {\n    const todoList_r2 = ctx.$implicit;\n    i0.ÉµÉµadvance(1);\n    i0.ÉµÉµproperty(\"todoList\", todoList_r2);\n  }\n}\n\nexport class HomeComponent {\n  constructor(crudApiService, cdr) {\n    this.crudApiService = crudApiService;\n    this.cdr = cdr;\n    this.todoLists$ = liveQuery(() => db.todoLists.toArray());\n    this.listName = 'My new list';\n    this.todoLists = [];\n  }\n\n  ngOnInit() {\n    /** all the lists created */\n    this.crudApiService.GetCrucrudInfos('').pipe(mergeMap(lists => // `from` emits each contact separately\n    from(lists).pipe( // load each contact\n    mergeMap(list => this.getListTodos(list)), // collect all contacts into an array\n    toArray(), // add the newly fetched data to original result\n    map(todoLists => ({ ...this.todoLists,\n      todoLists\n    }))))).subscribe(datas => {\n      this.todoLists = datas.todoLists;\n      console.log(\"datas >>>>>>>>>>> \", datas);\n      console.log(\"lists >>>>>>>>>>> \", this.todoLists);\n      this.cdr.detectChanges();\n    });\n    this.todoLists$.subscribe(datas => {\n      console.log(\"ğŸ’€\", datas);\n    });\n  }\n\n  getListTodos(list) {\n    return this.crudApiService.GetCrucrudInfos(list).pipe(map(todoItems => ({\n      title: list,\n      todoItems: todoItems\n    })));\n  } // private getListTodos(list: string) {\n  //   var obj: any = {};\n  //   return this.crudApiService.GetCrucrudInfos(list).pipe(\n  //     map(datas => {\n  //       obj[list] = datas\n  //       console.log(\"ğŸ’© \", list, obj)\n  //       return obj\n  //     })\n  //     // return ({name: datas})})\n  //   )\n  // }\n\n\n  addNewList() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      let listName = _this.listName.replace(/\\s/g, '').normalize(\"NFD\").replace(/\\p{Diacritic}/gu, \"\");\n\n      yield db.todoLists.add({\n        title: listName\n      });\n\n      _this.crudApiService.NewListRessouce(listName).pipe().subscribe(datas => {\n        console.log(\"datas >>> \", datas);\n      });\n    })();\n  }\n\n  resetDatabase() {\n    return _asyncToGenerator(function* () {\n      yield db.resetDatabase();\n    })();\n  }\n\n  identifyList(index, list) {\n    return `${list.id}${list.title}`;\n  }\n\n}\n\nHomeComponent.Éµfac = function HomeComponent_Factory(t) {\n  return new (t || HomeComponent)(i0.ÉµÉµdirectiveInject(i1.CrudApiService), i0.ÉµÉµdirectiveInject(i0.ChangeDetectorRef));\n};\n\nHomeComponent.Éµcmp = /*@__PURE__*/i0.ÉµÉµdefineComponent({\n  type: HomeComponent,\n  selectors: [[\"page-home\"]],\n  decls: 14,\n  vars: 3,\n  consts: [[1, \"newListContainer\", 2, \"margin-top\", \"30px\"], [\"autocomplete\", \"off\", \"type\", \"text\", \"id\", \"name\", 3, \"ngModel\", \"ngModelChange\"], [\"name\", \"\"], [\"type\", \"submit\", 3, \"click\"], [4, \"ngFor\", \"ngForOf\", \"ngForTrackBy\"], [3, \"click\"], [3, \"todoList\"]],\n  template: function HomeComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ÉµÉµelementStart(0, \"div\", 0)(1, \"h3\");\n      i0.ÉµÉµtext(2, \"New List : \");\n      i0.ÉµÉµelementEnd();\n      i0.ÉµÉµelementStart(3, \"label\");\n      i0.ÉµÉµtext(4, \" List : \");\n      i0.ÉµÉµelementStart(5, \"input\", 1, 2);\n      i0.ÉµÉµlistener(\"ngModelChange\", function HomeComponent_Template_input_ngModelChange_5_listener($event) {\n        return ctx.listName = $event;\n      });\n      i0.ÉµÉµelementEnd()();\n      i0.ÉµÉµelementStart(7, \"button\", 3);\n      i0.ÉµÉµlistener(\"click\", function HomeComponent_Template_button_click_7_listener() {\n        return ctx.addNewList();\n      });\n      i0.ÉµÉµtext(8, \"Add new list\");\n      i0.ÉµÉµelementEnd()();\n      i0.ÉµÉµtemplate(9, HomeComponent_div_9_Template, 2, 1, \"div\", 4);\n      i0.ÉµÉµelementStart(10, \"h3\");\n      i0.ÉµÉµtext(11, \"Reset the Database\");\n      i0.ÉµÉµelementEnd();\n      i0.ÉµÉµelementStart(12, \"button\", 5);\n      i0.ÉµÉµlistener(\"click\", function HomeComponent_Template_button_click_12_listener() {\n        return ctx.resetDatabase();\n      });\n      i0.ÉµÉµtext(13, \"Reset Database\");\n      i0.ÉµÉµelementEnd();\n    }\n\n    if (rf & 2) {\n      i0.ÉµÉµadvance(5);\n      i0.ÉµÉµproperty(\"ngModel\", ctx.listName);\n      i0.ÉµÉµadvance(4);\n      i0.ÉµÉµproperty(\"ngForOf\", ctx.todoLists)(\"ngForTrackBy\", ctx.identifyList);\n    }\n  },\n  dependencies: [i2.NgForOf, i3.DefaultValueAccessor, i3.NgControlStatus, i3.NgModel, i4.ItemListComponent],\n  styles: [\".newListContainer[_ngcontent-%COMP%] {\\n  margin-top: 30px;\\n  padding-bottom: 20px;\\n  border-bottom: 1px dashed #504f4f;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhvbWUuY29tcG9uZW50LnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDSSxnQkFBQTtFQUNBLG9CQUFBO0VBQ0EsaUNBQUE7QUFDSiIsImZpbGUiOiJob21lLmNvbXBvbmVudC5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiLm5ld0xpc3RDb250YWluZXIge1xyXG4gICAgbWFyZ2luLXRvcDogMzBweDtcclxuICAgIHBhZGRpbmctYm90dG9tOiAyMHB4O1xyXG4gICAgYm9yZGVyLWJvdHRvbTogMXB4IGRhc2hlZCAjNTA0ZjRmO1xyXG59Il19 */\"],\n  changeDetection: 0\n});","map":{"version":3,"mappings":"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","names":["ChangeDetectorRef","liveQuery","from","map","mergeMap","toArray","db","i0","HomeComponent","constructor","crudApiService","cdr","todoLists","ngOnInit","GetCrucrudInfos","pipe","lists","list","getListTodos","subscribe","datas","console","log","detectChanges","todoLists$","todoItems","title","addNewList","listName","replace","normalize","add","NewListRessouce","resetDatabase","identifyList","index","id","selectors","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["C:\\Users\\nicos\\Dev\\poc\\poc-pwa\\src\\app\\pages\\home\\home.component.ts","C:\\Users\\nicos\\Dev\\poc\\poc-pwa\\src\\app\\pages\\home\\home.component.html"],"sourcesContent":["import { ChangeDetectionStrategy, ChangeDetectorRef, Component, OnInit } from '@angular/core';\r\nimport { liveQuery } from 'dexie';\r\nimport { from, map, mergeMap, toArray } from 'rxjs';\r\nimport { CrudApiService } from 'src/services/crud-api.service';\r\nimport { db, TodoList } from 'src/services/db';\r\n\r\n@Component({\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n  selector: 'page-home',\r\n  templateUrl: './home.component.html',\r\n  styleUrls: ['./home.component.scss'],\r\n})\r\nexport class HomeComponent implements OnInit {\r\n  todoLists$ = liveQuery(() => db.todoLists.toArray());\r\n  listName = 'My new list';\r\n  todoLists: any[] = [];\r\n\r\n  constructor(\r\n    private crudApiService: CrudApiService,\r\n    private cdr: ChangeDetectorRef,) { }\r\n\r\n  ngOnInit(): void {\r\n\r\n    /** all the lists created */\r\n    this.crudApiService.GetCrucrudInfos('').pipe(\r\n      mergeMap((lists: string[]) =>\r\n        // `from` emits each contact separately\r\n        from(lists).pipe(\r\n          // load each contact\r\n          mergeMap((list: string) => this.getListTodos(list)),\r\n          // collect all contacts into an array\r\n          toArray(),\r\n          // add the newly fetched data to original result\r\n          map(todoLists => ({ ...this.todoLists, todoLists })),\r\n        ))\r\n    ).subscribe((datas: { todoLists: TodoList[] }) => {\r\n      this.todoLists = datas.todoLists\r\n\r\n      console.log(\"datas >>>>>>>>>>> \", datas)\r\n      console.log(\"lists >>>>>>>>>>> \", this.todoLists)\r\n\r\n      this.cdr.detectChanges()\r\n    })\r\n\r\n    this.todoLists$.subscribe((datas) => {\r\n      console.log(\"ğŸ’€\", datas)\r\n    })\r\n  }\r\n\r\n  private getListTodos(list: string) {\r\n    return this.crudApiService.GetCrucrudInfos(list).pipe(\r\n      map(todoItems => ({ title: list, todoItems: todoItems }))\r\n    )\r\n  }\r\n\r\n  // private getListTodos(list: string) {\r\n  //   var obj: any = {};\r\n\r\n  //   return this.crudApiService.GetCrucrudInfos(list).pipe(\r\n  //     map(datas => {\r\n  //       obj[list] = datas\r\n\r\n  //       console.log(\"ğŸ’© \", list, obj)\r\n  //       return obj\r\n  //     })\r\n  //     // return ({name: datas})})\r\n  //   )\r\n  // }\r\n\r\n  async addNewList() {\r\n\r\n    let listName: string = this.listName.replace(/\\s/g,'').normalize(\"NFD\").replace(/\\p{Diacritic}/gu, \"\")\r\n\r\n    await db.todoLists.add({\r\n      title: listName,\r\n    });\r\n\r\n    this.crudApiService.NewListRessouce(listName).pipe(\r\n    ).subscribe((datas: any) => {\r\n      console.log(\"datas >>> \", datas)\r\n    })\r\n  }\r\n\r\n  async resetDatabase() {\r\n    await db.resetDatabase();\r\n  }\r\n\r\n  identifyList(index: number, list: TodoList) {\r\n    return `${list.id}${list.title}`;\r\n  }\r\n}\r\n","<div class=\"newListContainer\" style=\"margin-top: 30px;\">\r\n    <h3>New List : </h3>\r\n    <label>\r\n        List :\r\n        <input autocomplete=\"off\" type=\"text\" id=\"name\" #name [(ngModel)]=\"listName\" />\r\n    </label>\r\n    <button type=\"submit\" (click)=\"addNewList()\">Add new list</button>\r\n</div>\r\n\r\n<!-- from api crud -->\r\n<div *ngFor=\"let todoList of todoLists; trackBy: identifyList\">\r\n    <item-list [todoList]=\"todoList\"></item-list>\r\n</div>\r\n<!-- <div *ngFor=\"let todoList of todoLists$ | async; trackBy: identifyList\">\r\n    <item-list [todoList]=\"todoList\"></item-list>\r\n</div> -->\r\n\r\n<h3>Reset the Database</h3>\r\n<button (click)=\"resetDatabase()\">Reset Database</button>"]},"metadata":{},"sourceType":"module"}