{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/nicos/Dev/poc/poc-pwa/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { ChangeDetectorRef } from '@angular/core';\nimport { liveQuery } from 'dexie';\nimport { db, ISynchroRecordType } from 'src/services/db';\nimport { IConnectionStatusValue } from '../../../../services/connection-status.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../../services/connection-status.service\";\nimport * as i2 from \"../../../../services/crud-api.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/forms\";\n\nfunction ItemListComponent_ng_container_9_li_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"li\");\n    i0.ÉµÉµtext(1);\n    i0.ÉµÉµelementEnd();\n  }\n\n  if (rf & 2) {\n    const item_r2 = i0.ÉµÉµnextContext().$implicit;\n    i0.ÉµÉµadvance(1);\n    i0.ÉµÉµtextInterpolate1(\" \", item_r2.title, \" \");\n  }\n}\n\nfunction ItemListComponent_ng_container_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementContainerStart(0);\n    i0.ÉµÉµtemplate(1, ItemListComponent_ng_container_9_li_1_Template, 2, 1, \"li\", 4);\n    i0.ÉµÉµelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const item_r2 = ctx.$implicit;\n    i0.ÉµÉµadvance(1);\n    i0.ÉµÉµproperty(\"ngIf\", item_r2.title);\n  }\n}\n\nexport class ItemListComponent {\n  constructor(cdr, connectionStatusService, crudApiService) {\n    this.cdr = cdr;\n    this.connectionStatusService = connectionStatusService;\n    this.crudApiService = crudApiService; // Observe an arbritary query:\n\n    this.todoItems$ = liveQuery(() => this.listTodoItems());\n    this.itemName = 'My new item';\n  }\n\n  ngOnInit() {\n    this.connectionStatusService.onConnectionStatutUpdated.subscribe(data => {\n      this.connectionStatus = data;\n    });\n  }\n\n  listTodoItems() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      return yield db.todoItems.where({\n        todoListId: _this.todoList.id\n      }).toArray();\n    })();\n  }\n  /** crÃ©ation de l'item de la liste */\n\n\n  addItem() {\n    if (this.connectionStatus === IConnectionStatusValue.ONLINE) {\n      this.crudApiService.NewListRessouce(this.todoList.title, this.itemName).pipe().subscribe(() => {\n        this.readDatas();\n      });\n    } else {\n      /** add en base local */\n      db.todoItems.add({\n        title: this.itemName,\n        todoListId: this.todoList.id,\n        recordType: ISynchroRecordType.ADD\n      }).then(id => {\n        this.readDatas();\n      });\n    }\n  } // private addIdTableSynchro(id: number) {\n  //   /** mÃ j table synchro */\n  //   db.synchro.add({\n  //     id: id,\n  //     recordType: ISynchroRecordType.ADD,\n  //   }).then(() => {\n  //     console.log(\"ðŸ’ª saved in synchro table\")\n  //   })\n  // }\n\n\n  readDatas() {\n    if (this.connectionStatus === IConnectionStatusValue.ONLINE) {\n      this.getTodoItemsFromListNameAPI();\n    } else {\n      this.getTodoItemsFromListNameIndexedDb();\n    }\n  }\n\n  getTodoItemsFromListNameAPI() {\n    this.crudApiService.GetCrucrudInfos(this.todoList.title).pipe().subscribe(todoItems => {\n      this.todoList.todoItems = todoItems;\n      this.cdr.detectChanges();\n    });\n  }\n\n  getTodoItemsFromListNameIndexedDb() {\n    db.todoItems.where({\n      todoListId: this.todoList.id\n    }).toArray().then(todoItems => {\n      this.todoList.todoItems = todoItems;\n      this.cdr.detectChanges();\n    });\n  }\n\n  trackBy(index) {\n    return index;\n  }\n\n}\n\nItemListComponent.Éµfac = function ItemListComponent_Factory(t) {\n  return new (t || ItemListComponent)(i0.ÉµÉµdirectiveInject(i0.ChangeDetectorRef), i0.ÉµÉµdirectiveInject(i1.ConnectionStatusService), i0.ÉµÉµdirectiveInject(i2.CrudApiService));\n};\n\nItemListComponent.Éµcmp = /*@__PURE__*/i0.ÉµÉµdefineComponent({\n  type: ItemListComponent,\n  selectors: [[\"item-list\"]],\n  inputs: {\n    todoList: \"todoList\"\n  },\n  decls: 10,\n  vars: 4,\n  consts: [[\"autocomplete\", \"off\", \"type\", \"text\", \"id\", \"name\", 3, \"ngModel\", \"ngModelChange\"], [\"name\", \"\"], [\"type\", \"submit\", 3, \"click\"], [4, \"ngFor\", \"ngForOf\", \"ngForTrackBy\"], [4, \"ngIf\"]],\n  template: function ItemListComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ÉµÉµelementStart(0, \"h3\");\n      i0.ÉµÉµtext(1);\n      i0.ÉµÉµelementEnd();\n      i0.ÉµÉµelementStart(2, \"label\");\n      i0.ÉµÉµtext(3, \" Todo : \");\n      i0.ÉµÉµelementStart(4, \"input\", 0, 1);\n      i0.ÉµÉµlistener(\"ngModelChange\", function ItemListComponent_Template_input_ngModelChange_4_listener($event) {\n        return ctx.itemName = $event;\n      });\n      i0.ÉµÉµelementEnd()();\n      i0.ÉµÉµelementStart(6, \"button\", 2);\n      i0.ÉµÉµlistener(\"click\", function ItemListComponent_Template_button_click_6_listener() {\n        return ctx.addItem();\n      });\n      i0.ÉµÉµtext(7, \"Add Todo\");\n      i0.ÉµÉµelementEnd();\n      i0.ÉµÉµelementStart(8, \"ul\");\n      i0.ÉµÉµtemplate(9, ItemListComponent_ng_container_9_Template, 2, 1, \"ng-container\", 3);\n      i0.ÉµÉµelementEnd();\n    }\n\n    if (rf & 2) {\n      i0.ÉµÉµadvance(1);\n      i0.ÉµÉµtextInterpolate1(\"List : \", ctx.todoList.title, \"\");\n      i0.ÉµÉµadvance(3);\n      i0.ÉµÉµproperty(\"ngModel\", ctx.itemName);\n      i0.ÉµÉµadvance(5);\n      i0.ÉµÉµproperty(\"ngForOf\", ctx.todoList.todoItems)(\"ngForTrackBy\", ctx.trackBy);\n    }\n  },\n  dependencies: [i3.NgForOf, i3.NgIf, i4.DefaultValueAccessor, i4.NgControlStatus, i4.NgModel],\n  styles: [\"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJpdGVtLWxpc3QuY29tcG9uZW50LnNjc3MifQ== */\"],\n  changeDetection: 0\n});","map":{"version":3,"mappings":"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","names":["ChangeDetectorRef","liveQuery","db","ISynchroRecordType","IConnectionStatusValue","i0","ItemListComponent","constructor","cdr","connectionStatusService","crudApiService","listTodoItems","ngOnInit","onConnectionStatutUpdated","subscribe","data","connectionStatus","todoItems","where","todoListId","todoList","id","toArray","addItem","ONLINE","NewListRessouce","title","itemName","pipe","readDatas","add","recordType","ADD","then","getTodoItemsFromListNameAPI","getTodoItemsFromListNameIndexedDb","GetCrucrudInfos","detectChanges","trackBy","index","selectors","inputs","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["C:\\Users\\nicos\\Dev\\poc\\poc-pwa\\src\\app\\pages\\home\\item-list\\item-list.component.ts","C:\\Users\\nicos\\Dev\\poc\\poc-pwa\\src\\app\\pages\\home\\item-list\\item-list.component.html"],"sourcesContent":["import { ChangeDetectionStrategy, ChangeDetectorRef, Component, Input } from '@angular/core';\r\nimport { liveQuery } from 'dexie';\r\nimport { db, ISynchroRecordType, TodoItem, TodoList } from 'src/services/db';\r\n\r\nimport { ConnectionStatusService, IConnectionStatusValue } from '../../../../services/connection-status.service';\r\nimport { CrudApiService } from '../../../../services/crud-api.service';\r\n\r\n@Component({\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n  selector: 'item-list',\r\n  templateUrl: './item-list.component.html',\r\n  styleUrls: ['./item-list.component.scss'],\r\n})\r\nexport class ItemListComponent {\r\n  @Input() todoList!: TodoList;\r\n\r\n  // Observe an arbritary query:\r\n  todoItems$ = liveQuery(() => this.listTodoItems());\r\n  connectionStatus!: IConnectionStatusValue;\r\n\r\n  constructor(\r\n    private cdr: ChangeDetectorRef,\r\n    private connectionStatusService: ConnectionStatusService,\r\n    private crudApiService: CrudApiService,) { }\r\n\r\n\r\n  ngOnInit(): void {\r\n    this.connectionStatusService.onConnectionStatutUpdated.subscribe((data: IConnectionStatusValue) => {\r\n      this.connectionStatus = data\r\n    })\r\n  }\r\n\r\n  async listTodoItems() {\r\n    return await db.todoItems\r\n      .where({\r\n        todoListId: this.todoList.id,\r\n      })\r\n      .toArray();\r\n  }\r\n\r\n  /** crÃ©ation de l'item de la liste */\r\n  public addItem() {\r\n    if (this.connectionStatus === IConnectionStatusValue.ONLINE) {\r\n      this.crudApiService.NewListRessouce(this.todoList.title, this.itemName).pipe(\r\n      ).subscribe(() => {\r\n        this.readDatas()\r\n      })\r\n    } else {\r\n      /** add en base local */\r\n      db.todoItems.add({\r\n        title: this.itemName,\r\n        todoListId: this.todoList.id,\r\n        recordType: ISynchroRecordType.ADD,\r\n      }).then((id: number) => {\r\n        this.readDatas()\r\n      })\r\n      \r\n    }\r\n  }\r\n  \r\n  // private addIdTableSynchro(id: number) {\r\n  //   /** mÃ j table synchro */\r\n  //   db.synchro.add({\r\n  //     id: id,\r\n  //     recordType: ISynchroRecordType.ADD,\r\n  //   }).then(() => {\r\n  //     console.log(\"ðŸ’ª saved in synchro table\")\r\n  //   })\r\n  // }\r\n\r\n  private readDatas() {\r\n    if (this.connectionStatus === IConnectionStatusValue.ONLINE) {\r\n      this.getTodoItemsFromListNameAPI()\r\n    } else {\r\n      this.getTodoItemsFromListNameIndexedDb()\r\n    }\r\n  }\r\n\r\n  private getTodoItemsFromListNameAPI() {\r\n    this.crudApiService.GetCrucrudInfos(this.todoList.title).pipe(\r\n    ).subscribe((todoItems: TodoItem[]) => {\r\n      this.todoList.todoItems = todoItems\r\n\r\n      this.cdr.detectChanges()\r\n    })\r\n  }\r\n\r\n  private getTodoItemsFromListNameIndexedDb() {\r\n    db.todoItems.where({\r\n      todoListId: this.todoList.id,\r\n    }).toArray().then((todoItems: TodoItem[]) => {\r\n      this.todoList.todoItems = todoItems\r\n\r\n      this.cdr.detectChanges()\r\n    })\r\n  }\r\n\r\n  trackBy(index: number) {\r\n    return index;\r\n  }\r\n\r\n  itemName = 'My new item';\r\n}\r\n","<h3>List : {{ todoList.title }}</h3>\r\n\r\n<!--\r\n    Adding item form\r\n-->\r\n<label>\r\n    Todo :\r\n    <input autocomplete=\"off\" type=\"text\" id=\"name\" #name [(ngModel)]=\"itemName\" />\r\n</label>\r\n<button type=\"submit\" (click)=\"addItem()\">Add Todo</button>\r\n\r\n<ul>\r\n    <ng-container *ngFor=\"let item of todoList.todoItems; trackBy: trackBy\">\r\n        <li *ngIf=\"item.title\"> {{ item.title }} </li>\r\n    </ng-container>\r\n</ul>\r\n\r\n<!-- <ul>\r\n    <li *ngFor=\"let item of todoItems$ | async\">\r\n        {{ item.title }}\r\n    </li>\r\n</ul> -->"]},"metadata":{},"sourceType":"module"}