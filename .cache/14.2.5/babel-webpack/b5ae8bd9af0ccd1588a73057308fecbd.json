{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/nicos/Dev/poc/poc-pwa/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { ChangeDetectorRef } from '@angular/core';\nimport { StringService } from 'cocori-ng/src/feature-core';\nimport { from, map, mergeMap, toArray } from 'rxjs';\nimport { db, ISynchroRecordType } from 'src/services/db';\nimport { IConnectionStatusValue } from '../../../services/connection-status.service';\nimport { SynchroService } from '../../../services/synchro.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../services/connection-status.service\";\nimport * as i2 from \"src/services/crud-api.service\";\nimport * as i3 from \"../../../services/synchro.service\";\nimport * as i4 from \"../../../services/crud-db.service\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@angular/forms\";\nimport * as i7 from \"./item-list/item-list.component\";\n\nfunction HomeComponent_div_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"div\");\n    i0.ÉµÉµelement(1, \"item-list\", 7);\n    i0.ÉµÉµelementEnd();\n  }\n\n  if (rf & 2) {\n    const todoList_r2 = ctx.$implicit;\n    i0.ÉµÉµadvance(1);\n    i0.ÉµÉµproperty(\"todoList\", todoList_r2);\n  }\n}\n\nexport class HomeComponent {\n  constructor(connectionStatusService, crudApiService, synchroService, crudDbService, cdr) {\n    this.connectionStatusService = connectionStatusService;\n    this.crudApiService = crudApiService;\n    this.synchroService = synchroService;\n    this.crudDbService = crudDbService;\n    this.cdr = cdr;\n    this.listName = 'My new list';\n    this.todoLists = [];\n  }\n\n  ngOnInit() {\n    this.connectionStatusService.onConnectionStatutUpdated.subscribe(data => {\n      this.connectionStatus = data;\n      this.readDatas();\n    });\n  }\n\n  readDatas() {\n    this.todoLists = [];\n    this.crudDbService.getRecords().subscribe(datas => {\n      console.log(\"ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥\", datas);\n    });\n\n    if (this.connectionStatus === IConnectionStatusValue.ONLINE) {\n      this.getAllTodosListItemsAPI();\n    } else {\n      this.getAllTodosListItemsIndexedDb();\n    }\n  }\n\n  getAllTodosListItemsIndexedDb() {\n    this.todoLists = [];\n    db.todoLists.toArray().then(datas => {\n      /** each list name */\n      datas.forEach(data => {\n        const listeName = data.title;\n        db.todoItems.where({\n          todoListId: data.id\n        }).toArray().then(todoItems => {\n          this.todoLists.push({\n            id: data.id,\n            title: listeName,\n            todoItems: todoItems\n          });\n          this.cdr.detectChanges();\n        });\n      });\n    });\n  }\n\n  getAllTodosListItemsAPI() {\n    /** all the lists created */\n    this.crudApiService.GetCrucrudInfos('').pipe(mergeMap(lists => // `from` emits each contact separately\n    from(lists).pipe( // load each contact\n    mergeMap(list => this.getListTodoItems(list)), // collect all contacts into an array\n    toArray(), // add the newly fetched data to original result\n    map(todoLists => ({ ...this.todoLists,\n      todoLists\n    }))))).subscribe(datas => {\n      this.todoLists = datas.todoLists;\n      console.log(\"Todolists from api >>>>>>>>>>> \", this.todoLists);\n      this.cdr.detectChanges();\n    });\n  }\n  /**\r\n   * It takes a list name as a parameter, calls the GetCrucrudInfos function from the crudApiService,\r\n   * and then maps the result to an object with a title and todoItems property.\r\n   * @param {string} listName - string - the name of the list you want to get the items from\r\n   * @returns An Observable of type { title: string, todoItems: any[] }\r\n   */\n\n\n  getListTodoItems(listName) {\n    return this.crudApiService.GetCrucrudInfos(listName).pipe(map(todoItems => ({\n      title: listName,\n      todoItems: todoItems\n    })));\n  }\n\n  addNewList() {\n    this.listName = new StringService(this.listName).removeAllSpaces().removeAllSpecialsCharacters().replaceAllAccentByNonAccentCharacters().toString();\n\n    if (this.connectionStatus === IConnectionStatusValue.ONLINE) {\n      this.crudApiService.NewListRessouce(this.listName).pipe().subscribe(datas => {\n        this.readDatas();\n      });\n    } else {\n      db.todoLists.add({\n        title: this.listName,\n        recordType: ISynchroRecordType.ADD\n      }).then(id => {\n        this.readDatas();\n      });\n    }\n  }\n\n  resetDatabase() {\n    return _asyncToGenerator(function* () {\n      yield db.resetDatabase();\n    })();\n  }\n\n  identifyList(index, list) {\n    return `${list.id}${list.title}`;\n  }\n\n  sychronize() {\n    if (this.connectionStatus === IConnectionStatusValue.ONLINE) {\n      /** synchronise local to server */\n      console.log(\"ğŸ’ª synchronise local to server\");\n      this.synchroService.indexedDBToServer();\n      setTimeout(() => {\n        /** reset local database */\n        console.log(\"ğŸ’ª reset local database\");\n        this.resetDatabase().then(() => {\n          /** synchro Server To local  */\n          console.log(\"ğŸ’ª synchro Server To local\");\n          this.getAllTodosListItemsAPI();\n          setTimeout(() => {\n            this.synchroService.serverToIndexedDB(this.todoLists);\n            setTimeout(() => {\n              /** refresh liste */\n              this.readDatas();\n            }, 1000);\n          }, 1000);\n        });\n      }, 1000);\n    } else {\n      window.alert(\"Vous devez Ãªtre connectÃ© au rÃ©seau pour synchroniser les donnÃ©es de l'application.\");\n    }\n  }\n\n}\n\nHomeComponent.Éµfac = function HomeComponent_Factory(t) {\n  return new (t || HomeComponent)(i0.ÉµÉµdirectiveInject(i1.ConnectionStatusService), i0.ÉµÉµdirectiveInject(i2.CrudApiService), i0.ÉµÉµdirectiveInject(i3.SynchroService), i0.ÉµÉµdirectiveInject(i4.CrudDbService), i0.ÉµÉµdirectiveInject(i0.ChangeDetectorRef));\n};\n\nHomeComponent.Éµcmp = /*@__PURE__*/i0.ÉµÉµdefineComponent({\n  type: HomeComponent,\n  selectors: [[\"page-home\"]],\n  features: [i0.ÉµÉµProvidersFeature([SynchroService])],\n  decls: 17,\n  vars: 3,\n  consts: [[1, \"btnSynchro\"], [\"type\", \"submit\", 3, \"click\"], [1, \"newListContainer\", 2, \"margin-top\", \"30px\"], [\"autocomplete\", \"off\", \"type\", \"text\", \"id\", \"name\", 3, \"ngModel\", \"ngModelChange\"], [\"name\", \"\"], [4, \"ngFor\", \"ngForOf\", \"ngForTrackBy\"], [3, \"click\"], [3, \"todoList\"]],\n  template: function HomeComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ÉµÉµelementStart(0, \"div\", 0)(1, \"button\", 1);\n      i0.ÉµÉµlistener(\"click\", function HomeComponent_Template_button_click_1_listener() {\n        return ctx.sychronize();\n      });\n      i0.ÉµÉµtext(2, \"\\uD83D\\uDD01 Synchroniser\");\n      i0.ÉµÉµelementEnd()();\n      i0.ÉµÉµelementStart(3, \"div\", 2)(4, \"h3\");\n      i0.ÉµÉµtext(5, \"New List : \");\n      i0.ÉµÉµelementEnd();\n      i0.ÉµÉµelementStart(6, \"label\");\n      i0.ÉµÉµtext(7, \" List : \");\n      i0.ÉµÉµelementStart(8, \"input\", 3, 4);\n      i0.ÉµÉµlistener(\"ngModelChange\", function HomeComponent_Template_input_ngModelChange_8_listener($event) {\n        return ctx.listName = $event;\n      });\n      i0.ÉµÉµelementEnd()();\n      i0.ÉµÉµelementStart(10, \"button\", 1);\n      i0.ÉµÉµlistener(\"click\", function HomeComponent_Template_button_click_10_listener() {\n        return ctx.addNewList();\n      });\n      i0.ÉµÉµtext(11, \"Add new list\");\n      i0.ÉµÉµelementEnd()();\n      i0.ÉµÉµtemplate(12, HomeComponent_div_12_Template, 2, 1, \"div\", 5);\n      i0.ÉµÉµelementStart(13, \"h3\");\n      i0.ÉµÉµtext(14, \"Reset the Database\");\n      i0.ÉµÉµelementEnd();\n      i0.ÉµÉµelementStart(15, \"button\", 6);\n      i0.ÉµÉµlistener(\"click\", function HomeComponent_Template_button_click_15_listener() {\n        return ctx.resetDatabase();\n      });\n      i0.ÉµÉµtext(16, \"Reset Database\");\n      i0.ÉµÉµelementEnd();\n    }\n\n    if (rf & 2) {\n      i0.ÉµÉµadvance(8);\n      i0.ÉµÉµproperty(\"ngModel\", ctx.listName);\n      i0.ÉµÉµadvance(4);\n      i0.ÉµÉµproperty(\"ngForOf\", ctx.todoLists)(\"ngForTrackBy\", ctx.identifyList);\n    }\n  },\n  dependencies: [i5.NgForOf, i6.DefaultValueAccessor, i6.NgControlStatus, i6.NgModel, i7.ItemListComponent],\n  styles: [\".newListContainer[_ngcontent-%COMP%] {\\n  margin-top: 30px;\\n  padding-bottom: 20px;\\n  border-bottom: 1px dashed #504f4f;\\n}\\n\\n.btnSynchro[_ngcontent-%COMP%] {\\n  text-align: center;\\n  margin-top: 10px;\\n}\\n\\n.btnSynchro[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] {\\n  margin: 0 5px;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhvbWUuY29tcG9uZW50LnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDRSxnQkFBQTtFQUNBLG9CQUFBO0VBQ0EsaUNBQUE7QUFDRjs7QUFFQTtFQUNFLGtCQUFBO0VBQ0EsZ0JBQUE7QUFDRjs7QUFDRTtFQUNFLGFBQUE7QUFDSiIsImZpbGUiOiJob21lLmNvbXBvbmVudC5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiLm5ld0xpc3RDb250YWluZXIge1xyXG4gIG1hcmdpbi10b3A6IDMwcHg7XHJcbiAgcGFkZGluZy1ib3R0b206IDIwcHg7XHJcbiAgYm9yZGVyLWJvdHRvbTogMXB4IGRhc2hlZCAjNTA0ZjRmO1xyXG59XHJcblxyXG4uYnRuU3luY2hybyB7XHJcbiAgdGV4dC1hbGlnbjogY2VudGVyOyBcclxuICBtYXJnaW4tdG9wOiAxMHB4O1xyXG5cclxuICBidXR0b24ge1xyXG4gICAgbWFyZ2luOiAwIDVweDtcclxuICB9XHJcbn1cclxuIl19 */\"],\n  changeDetection: 0\n});","map":{"version":3,"mappings":";AAAA,SAAkCA,iBAAlC,QAA8E,eAA9E;AACA,SAASC,aAAT,QAA8B,4BAA9B;AACA,SAASC,IAAT,EAAeC,GAAf,EAAoBC,QAApB,EAA8BC,OAA9B,QAA6C,MAA7C;AAEA,SAASC,EAAT,EAAaC,kBAAb,QAA2D,iBAA3D;AAEA,SAAkCC,sBAAlC,QAAgE,6CAAhE;AAEA,SAASC,cAAT,QAA+B,mCAA/B;;;;;;;;;;;;ICOAC;IACIA;IACJA;;;;;IADeA;IAAAA;;;;ADCf,OAAM,MAAOC,aAAP,CAAoB;EAKxBC,YACUC,uBADV,EAEUC,cAFV,EAGUC,cAHV,EAIUC,aAJV,EAKUC,GALV,EAKgC;IAJtB;IACA;IACA;IACA;IACA;IATV,gBAAW,aAAX;IACA,iBAAwB,EAAxB;EAQsC;;EAEtCC,QAAQ;IAEN,KAAKL,uBAAL,CAA6BM,yBAA7B,CAAuDC,SAAvD,CAAkEC,IAAD,IAAiC;MAChG,KAAKC,gBAAL,GAAwBD,IAAxB;MAEA,KAAKE,SAAL;IACD,CAJD;EAKD;;EAEOA,SAAS;IACf,KAAKC,SAAL,GAAiB,EAAjB;IAEA,KAAKR,aAAL,CAAmBS,UAAnB,GAAgCL,SAAhC,CAA2CM,KAAD,IAAsB;MAC9DC,OAAO,CAACC,GAAR,CAAY,UAAZ,EAAwBF,KAAxB;IACD,CAFD;;IAIA,IAAI,KAAKJ,gBAAL,KAA0Bd,sBAAsB,CAACqB,MAArD,EAA6D;MAC3D,KAAKC,uBAAL;IACD,CAFD,MAEO;MACL,KAAKC,6BAAL;IACD;EACF;;EAEOA,6BAA6B;IACnC,KAAKP,SAAL,GAAiB,EAAjB;IAEAlB,EAAE,CAACkB,SAAH,CAAanB,OAAb,GAAuB2B,IAAvB,CAA6BN,KAAD,IAAsB;MAChD;MACAA,KAAK,CAACO,OAAN,CAAeZ,IAAD,IAAmB;QAC/B,MAAMa,SAAS,GAAWb,IAAI,CAACc,KAA/B;QAEA7B,EAAE,CAAC8B,SAAH,CAAaC,KAAb,CAAmB;UACjBC,UAAU,EAAEjB,IAAI,CAACkB;QADA,CAAnB,EAEGlC,OAFH,GAEa2B,IAFb,CAEmBI,SAAD,IAA0B;UAC1C,KAAKZ,SAAL,CAAegB,IAAf,CAAoB;YAAED,EAAE,EAAElB,IAAI,CAACkB,EAAX;YAAeJ,KAAK,EAAED,SAAtB;YAAiCE,SAAS,EAAEA;UAA5C,CAApB;UAEA,KAAKnB,GAAL,CAASwB,aAAT;QACD,CAND;MAOD,CAVD;IAWD,CAbD;EAcD;;EAEOX,uBAAuB;IAC7B;IACA,KAAKhB,cAAL,CAAoB4B,eAApB,CAAoC,EAApC,EAAwCC,IAAxC,CACEvC,QAAQ,CAAEwC,KAAD,IACP;IACA1C,IAAI,CAAC0C,KAAD,CAAJ,CAAYD,IAAZ,EACE;IACAvC,QAAQ,CAAEyC,IAAD,IAAkB,KAAKC,gBAAL,CAAsBD,IAAtB,CAAnB,CAFV,EAGE;IACAxC,OAAO,EAJT,EAKE;IACAF,GAAG,CAACqB,SAAS,KAAK,EAAE,GAAG,KAAKA,SAAV;MAAqBA;IAArB,CAAL,CAAV,CANL,CAFM,CADV,EAWEJ,SAXF,CAWaM,KAAD,IAAqC;MAC/C,KAAKF,SAAL,GAAiBE,KAAK,CAACF,SAAvB;MAEAG,OAAO,CAACC,GAAR,CAAY,iCAAZ,EAA+C,KAAKJ,SAApD;MAEA,KAAKP,GAAL,CAASwB,aAAT;IACD,CAjBD;EAkBD;EAED;;;;;;;;EAMQK,gBAAgB,CAACC,QAAD,EAAiB;IACvC,OAAO,KAAKjC,cAAL,CAAoB4B,eAApB,CAAoCK,QAApC,EAA8CJ,IAA9C,CACLxC,GAAG,CAACiC,SAAS,KAAK;MAAED,KAAK,EAAEY,QAAT;MAAmBX,SAAS,EAAEA;IAA9B,CAAL,CAAV,CADE,CAAP;EAGD;;EAEMY,UAAU;IACf,KAAKD,QAAL,GAAgB,IAAI9C,aAAJ,CAAkB,KAAK8C,QAAvB,EACbE,eADa,GAEbC,2BAFa,GAGbC,qCAHa,GAIbC,QAJa,EAAhB;;IAMA,IAAI,KAAK9B,gBAAL,KAA0Bd,sBAAsB,CAACqB,MAArD,EAA6D;MAC3D,KAAKf,cAAL,CAAoBuC,eAApB,CAAoC,KAAKN,QAAzC,EAAmDJ,IAAnD,GACEvB,SADF,CACaM,KAAD,IAAe;QACzB,KAAKH,SAAL;MACD,CAHD;IAID,CALD,MAKO;MACLjB,EAAE,CAACkB,SAAH,CAAa8B,GAAb,CAAiB;QACfnB,KAAK,EAAE,KAAKY,QADG;QAEfQ,UAAU,EAAEhD,kBAAkB,CAACiD;MAFhB,CAAjB,EAGGxB,IAHH,CAGSO,EAAD,IAAe;QACrB,KAAKhB,SAAL;MACD,CALD;IAMD;EACF;;EAEKkC,aAAa;IAAA;MACjB,MAAMnD,EAAE,CAACmD,aAAH,EAAN;IADiB;EAElB;;EAEDC,YAAY,CAACC,KAAD,EAAgBd,IAAhB,EAA8B;IACxC,OAAO,GAAGA,IAAI,CAACN,EAAE,GAAGM,IAAI,CAACV,KAAK,EAA9B;EACD;;EAEMyB,UAAU;IACf,IAAI,KAAKtC,gBAAL,KAA0Bd,sBAAsB,CAACqB,MAArD,EAA6D;MAE3D;MACAF,OAAO,CAACC,GAAR,CAAY,gCAAZ;MACA,KAAKb,cAAL,CAAoB8C,iBAApB;MAEAC,UAAU,CAAC,MAAK;QAEd;QACAnC,OAAO,CAACC,GAAR,CAAY,yBAAZ;QACA,KAAK6B,aAAL,GAAqBzB,IAArB,CAA0B,MAAK;UAE7B;UACAL,OAAO,CAACC,GAAR,CAAY,4BAAZ;UAEA,KAAKE,uBAAL;UAEAgC,UAAU,CAAC,MAAK;YACd,KAAK/C,cAAL,CAAoBgD,iBAApB,CAAsC,KAAKvC,SAA3C;YAEAsC,UAAU,CAAC,MAAK;cACd;cACA,KAAKvC,SAAL;YACD,CAHS,EAGP,IAHO,CAAV;UAID,CAPS,EAOP,IAPO,CAAV;QAQD,CAfD;MAgBD,CApBS,EAoBP,IApBO,CAAV;IAqBD,CA3BD,MA2BO;MACLyC,MAAM,CAACC,KAAP,CAAa,oFAAb;IACD;EACF;;AArJuB;;;mBAAbtD,eAAaD;AAAA;;;QAAbC;EAAauD;EAAAC,iCAFb,CAAC1D,cAAD,CAEa;EAFG2D;EAAAC;EAAAC;EAAAC;IAAA;MCd7B7D,+BAAwB,CAAxB,EAAwB,QAAxB,EAAwB,CAAxB;MAC0BA;QAAA,OAAS8D,gBAAT;MAAqB,CAArB;MAAuB9D;MAAeA;MAGhEA,+BAAwD,CAAxD,EAAwD,IAAxD;MACQA;MAAWA;MACfA;MACIA;MACAA;MAAsDA;QAAA;MAAA;MAAtDA;MAEJA;MAAsBA;QAAA,OAAS8D,gBAAT;MAAqB,CAArB;MAAuB9D;MAAYA;MAI7DA;MAOAA;MAAIA;MAAkBA;MACtBA;MAAQA;QAAA,OAAS8D,mBAAT;MAAwB,CAAxB;MAA0B9D;MAAcA;;;;MAdcA;MAAAA;MAMpCA;MAAAA,wCAAc,cAAd,EAAc8D,gBAAd","names":["ChangeDetectorRef","StringService","from","map","mergeMap","toArray","db","ISynchroRecordType","IConnectionStatusValue","SynchroService","i0","HomeComponent","constructor","connectionStatusService","crudApiService","synchroService","crudDbService","cdr","ngOnInit","onConnectionStatutUpdated","subscribe","data","connectionStatus","readDatas","todoLists","getRecords","datas","console","log","ONLINE","getAllTodosListItemsAPI","getAllTodosListItemsIndexedDb","then","forEach","listeName","title","todoItems","where","todoListId","id","push","detectChanges","GetCrucrudInfos","pipe","lists","list","getListTodoItems","listName","addNewList","removeAllSpaces","removeAllSpecialsCharacters","replaceAllAccentByNonAccentCharacters","toString","NewListRessouce","add","recordType","ADD","resetDatabase","identifyList","index","sychronize","indexedDBToServer","setTimeout","serverToIndexedDB","window","alert","selectors","features","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["C:\\Users\\nicos\\Dev\\poc\\poc-pwa\\src\\app\\pages\\home\\home.component.ts","C:\\Users\\nicos\\Dev\\poc\\poc-pwa\\src\\app\\pages\\home\\home.component.html"],"sourcesContent":["import { ChangeDetectionStrategy, ChangeDetectorRef, Component, OnInit } from '@angular/core';\r\nimport { StringService } from 'cocori-ng/src/feature-core';\r\nimport { from, map, mergeMap, toArray } from 'rxjs';\r\nimport { CrudApiService } from 'src/services/crud-api.service';\r\nimport { db, ISynchroRecordType, TodoItem, TodoList } from 'src/services/db';\r\n\r\nimport { ConnectionStatusService, IConnectionStatusValue } from '../../../services/connection-status.service';\r\nimport { CrudDbService } from '../../../services/crud-db.service';\r\nimport { SynchroService } from '../../../services/synchro.service';\r\n\r\n@Component({\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n  selector: 'page-home',\r\n  templateUrl: './home.component.html',\r\n  styleUrls: ['./home.component.scss'],\r\n  providers: [SynchroService]\r\n})\r\nexport class HomeComponent implements OnInit {\r\n  listName = 'My new list';\r\n  todoLists: TodoList[] = [];\r\n  connectionStatus!: IConnectionStatusValue;\r\n\r\n  constructor(\r\n    private connectionStatusService: ConnectionStatusService,\r\n    private crudApiService: CrudApiService,\r\n    private synchroService: SynchroService,\r\n    private crudDbService: CrudDbService,\r\n    private cdr: ChangeDetectorRef,) { }\r\n\r\n  ngOnInit(): void {\r\n\r\n    this.connectionStatusService.onConnectionStatutUpdated.subscribe((data: IConnectionStatusValue) => {\r\n      this.connectionStatus = data\r\n\r\n      this.readDatas()\r\n    })\r\n  }\r\n\r\n  private readDatas() {\r\n    this.todoLists = []\r\n\r\n    this.crudDbService.getRecords().subscribe((datas: TodoList[]) => {\r\n      console.log(\"ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥\", datas)\r\n    })\r\n    \r\n    if (this.connectionStatus === IConnectionStatusValue.ONLINE) {\r\n      this.getAllTodosListItemsAPI()\r\n    } else {\r\n      this.getAllTodosListItemsIndexedDb()\r\n    }\r\n  }\r\n\r\n  private getAllTodosListItemsIndexedDb() {\r\n    this.todoLists = []\r\n\r\n    db.todoLists.toArray().then((datas: TodoList[]) => {\r\n      /** each list name */\r\n      datas.forEach((data: TodoList) => {\r\n        const listeName: string = data.title\r\n\r\n        db.todoItems.where({\r\n          todoListId: data.id,\r\n        }).toArray().then((todoItems: TodoItem[]) => {\r\n          this.todoLists.push({ id: data.id, title: listeName, todoItems: todoItems })\r\n\r\n          this.cdr.detectChanges()\r\n        })\r\n      })\r\n    })\r\n  }\r\n\r\n  private getAllTodosListItemsAPI() {\r\n    /** all the lists created */\r\n    this.crudApiService.GetCrucrudInfos('').pipe(\r\n      mergeMap((lists: string[]) =>\r\n        // `from` emits each contact separately\r\n        from(lists).pipe(\r\n          // load each contact\r\n          mergeMap((list: string) => this.getListTodoItems(list)),\r\n          // collect all contacts into an array\r\n          toArray(),\r\n          // add the newly fetched data to original result\r\n          map(todoLists => ({ ...this.todoLists, todoLists })),\r\n        ))\r\n    ).subscribe((datas: { todoLists: TodoList[] }) => {\r\n      this.todoLists = datas.todoLists\r\n\r\n      console.log(\"Todolists from api >>>>>>>>>>> \", this.todoLists)\r\n\r\n      this.cdr.detectChanges()\r\n    })\r\n  }\r\n\r\n  /**\r\n   * It takes a list name as a parameter, calls the GetCrucrudInfos function from the crudApiService,\r\n   * and then maps the result to an object with a title and todoItems property.\r\n   * @param {string} listName - string - the name of the list you want to get the items from\r\n   * @returns An Observable of type { title: string, todoItems: any[] }\r\n   */\r\n  private getListTodoItems(listName: string) {\r\n    return this.crudApiService.GetCrucrudInfos(listName).pipe(\r\n      map(todoItems => ({ title: listName, todoItems: todoItems }))\r\n    )\r\n  }\r\n\r\n  public addNewList() {\r\n    this.listName = new StringService(this.listName)\r\n      .removeAllSpaces()\r\n      .removeAllSpecialsCharacters()\r\n      .replaceAllAccentByNonAccentCharacters()\r\n      .toString()\r\n\r\n    if (this.connectionStatus === IConnectionStatusValue.ONLINE) {\r\n      this.crudApiService.NewListRessouce(this.listName).pipe(\r\n      ).subscribe((datas: any) => {\r\n        this.readDatas()\r\n      })\r\n    } else {\r\n      db.todoLists.add({\r\n        title: this.listName,\r\n        recordType: ISynchroRecordType.ADD,\r\n      }).then((id: number) => {\r\n        this.readDatas()\r\n      })\r\n    }\r\n  }\r\n\r\n  async resetDatabase() {\r\n    await db.resetDatabase();\r\n  }\r\n\r\n  identifyList(index: number, list: TodoList) {\r\n    return `${list.id}${list.title}`;\r\n  }\r\n\r\n  public sychronize() {\r\n    if (this.connectionStatus === IConnectionStatusValue.ONLINE) {\r\n\r\n      /** synchronise local to server */\r\n      console.log(\"ğŸ’ª synchronise local to server\")\r\n      this.synchroService.indexedDBToServer()\r\n\r\n      setTimeout(() => {\r\n\r\n        /** reset local database */\r\n        console.log(\"ğŸ’ª reset local database\")\r\n        this.resetDatabase().then(() => {\r\n\r\n          /** synchro Server To local  */\r\n          console.log(\"ğŸ’ª synchro Server To local\")\r\n\r\n          this.getAllTodosListItemsAPI()\r\n\r\n          setTimeout(() => {\r\n            this.synchroService.serverToIndexedDB(this.todoLists)\r\n\r\n            setTimeout(() => {\r\n              /** refresh liste */\r\n              this.readDatas()\r\n            }, 1000)\r\n          }, 1000)\r\n        })\r\n      }, 1000);\r\n    } else {\r\n      window.alert(\"Vous devez Ãªtre connectÃ© au rÃ©seau pour synchroniser les donnÃ©es de l'application.\")\r\n    }\r\n  }\r\n}\r\n","\r\n<div class=\"btnSynchro\">\r\n    <button type=\"submit\" (click)=\"sychronize()\">ğŸ” Synchroniser</button>\r\n</div>\r\n\r\n<div class=\"newListContainer\" style=\"margin-top: 30px;\">\r\n    <h3>New List : </h3>\r\n    <label>\r\n        List :\r\n        <input autocomplete=\"off\" type=\"text\" id=\"name\" #name [(ngModel)]=\"listName\" />\r\n    </label>\r\n    <button type=\"submit\" (click)=\"addNewList()\">Add new list</button>\r\n</div>\r\n\r\n<!-- from api crud -->\r\n<div *ngFor=\"let todoList of todoLists; trackBy: identifyList\">\r\n    <item-list [todoList]=\"todoList\"></item-list>\r\n</div>\r\n<!-- <div *ngFor=\"let todoList of todoLists$ | async; trackBy: identifyList\">\r\n    <item-list [todoList]=\"todoList\"></item-list>\r\n</div> -->\r\n\r\n<h3>Reset the Database</h3>\r\n<button (click)=\"resetDatabase()\">Reset Database</button>"]},"metadata":{},"sourceType":"module"}